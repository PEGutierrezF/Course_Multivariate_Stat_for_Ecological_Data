---
title: "Principal Component Analysis (PCA)"
author: "Pablo E. Guti√©rrez-Fonseca"
date: "8/26/2021"
output:
  pdf_document: default
---


1. Primer paso: cargar las librerias que necesitas.


```{r, warning=FALSE,message=FALSE}


library(ggplot2)
library(dplyr)
library(missMDA) # Imputate
library(ggfortify) # autoplot()
library(cluster) #pam
library(factoextra) #get_pca_var()

library(devtools)
install_github("vqv/ggbiplot") #ggbiplot
library(ggbiplot)

```

2. Segundo paso: carga los datos.

```{r}
channel <- read.csv("data/channel_form.csv", header=TRUE)
head(channel)

```


2.1 Vamos a examinar los datos

```{r}
summary(channel)

```


2.1 Remover la(s) variable(s) que tiene(n) mucho(s) NAs y las Etiquetas (a la funcion lo le gusta), luego las agregamos.

```{r}

channel_1 <- select(channel, -Forma, -nit, -NADBO)
summary(channel_1)

```

2.2 Vamos a imputar datos.  Esto es comun para set de datos de campo, los cuales tienden a tener ceros (por mal funcionamiento de los equipos, condiciones climticas adversas que no puedemos ir al campo).  Se realiza como un paso preliminar para para
realizar un PCA en un set de datos completos.

Mas informacion aca:  https://www.rdocumentation.org/packages/missMDA/versions/1.18/topics/imputePCA

```{r}
channel_2 <- imputePCA(channel_1, ncp=2, scale = TRUE, method = c("Regularized","EM"), 
                      row.w = NULL, ind.sup=NULL,quanti.sup=NULL,quali.sup=NULL,
                      coeff.ridge = 1, threshold = 1e-06, seed = NULL, nb.init = 1,  
                      maxiter = 1000)

# class(channel_2)
# as.data.frame(channel_2)

```

3.  Vamos a correr el PCA

```{r}
channel.pca <- prcomp(channel_2$completeObs, center = TRUE, scale = TRUE)
summary(channel.pca)

```


3.1 Vamos a ver el grafico.

```{r}

autoplot(channel.pca)

autoplot(channel.pca, data = channel, colour = 'Forma')

autoplot(channel.pca, data = channel, colour = 'Forma', loadings = TRUE)

autoplot(channel.pca, data = channel, colour = 'Forma', loadings = TRUE,
         loadings.colour = 'blue', 
         loadings.label = TRUE, loadings.label.size = 3)



```

Otra manera de ver el grafico

```{r}

ggbiplot(channel.pca, labels=rownames(channel$Forma))

```

3.2 Ver graficamente lo que explica cada axis.

```{r}

layout(matrix(1:2, ncol=2))
screeplot(channel.pca)
screeplot(channel.pca, type="lines")


```


3.3 Vamos a ver la contribucion de cada una de las variables. 
Usamos otra libreria. factoextra

```{r}

get_eigenvalue(channel.pca)
res.var <- get_pca_var(channel.pca)
res.var$contrib        # Contributions to the PCs
res.var$coord          # Coordinates
res.var$cos2           # Quality of representation 

```

4  Otras formas de visualizar los datos.
```{r}
fviz_eig(channel.pca)


fviz_pca_biplot(channel.pca, repel = TRUE,
                col.var = "#2E9FDF", # Variables color
                col.ind = "#696969"  # Individuals color
                )

```



